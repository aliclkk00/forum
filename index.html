<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Hizliyim GiriÅŸ / KayÄ±t</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 400px; margin: auto; }
    form { display: none; }
    form.active { display: block; }
    input, button { width: 100%; margin: 8px 0; padding: 10px; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDocs, collection, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    // ğŸ”¥ Senin verdiÄŸin Firebase ayarlarÄ±
    const firebaseConfig = {
      apiKey: "AIzaSyDwzXBKPHk_6MM68W9fGjupP8UckPNSBRQ",
      authDomain: "hizliyim-3f99c.firebaseapp.com",
      projectId: "hizliyim-3f99c",
      storageBucket: "hizliyim-3f99c.appspot.com",
      messagingSenderId: "333626964299",
      appId: "1:333626964299:web:1879c6b0a7c89acbd4bff2"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.addEventListener("DOMContentLoaded", () => {
      const loginForm = document.getElementById("loginForm");
      const registerForm = document.getElementById("registerForm");
      const switchToLogin = document.getElementById("switchToLogin");
      const switchToRegister = document.getElementById("switchToRegister");

      switchToLogin.onclick = () => {
        loginForm.classList.add("active");
        registerForm.classList.remove("active");
      };
      switchToRegister.onclick = () => {
        registerForm.classList.add("active");
        loginForm.classList.remove("active");
      };

      // ğŸŸ¢ KayÄ±t iÅŸlemi
      registerForm.onsubmit = async (e) => {
        e.preventDefault();
        const username = document.getElementById("regUsername").value.trim();
        const email = document.getElementById("regEmail").value.trim();
        const password = document.getElementById("regPassword").value;

        if (username.length < 3) return alert("KullanÄ±cÄ± adÄ± en az 3 karakter olmalÄ±.");
        if (password.length < 6) return alert("Åifre en az 6 karakter olmalÄ±.");

        try {
          // E-posta kontrolÃ¼
          const emailQuery = query(collection(db, "users"), where("email", "==", email));
          const emailSnap = await getDocs(emailQuery);
          if (!emailSnap.empty) return alert("Bu e-posta zaten kullanÄ±lÄ±yor.");

          // KullanÄ±cÄ± adÄ± kontrolÃ¼
          const usernameQuery = query(collection(db, "users"), where("username", "==", username));
          const usernameSnap = await getDocs(usernameQuery);
          if (!usernameSnap.empty) return alert("Bu kullanÄ±cÄ± adÄ± zaten alÄ±nmÄ±ÅŸ.");

          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          const uid = userCredential.user.uid;

          await setDoc(doc(db, "users", uid), {
            username,
            email,
            createdAt: serverTimestamp()
          });

          alert("KayÄ±t baÅŸarÄ±lÄ±! GiriÅŸ yapabilirsiniz.");
          switchToLogin.click();
        } catch (err) {
          alert("Hata: " + err.message);
        }
      };

      // ğŸŸ¢ GiriÅŸ iÅŸlemi
      loginForm.onsubmit = async (e) => {
        e.preventDefault();
        const email = document.getElementById("loginEmail").value.trim();
        const password = document.getElementById("loginPassword").value;

        try {
          await signInWithEmailAndPassword(auth, email, password);
          alert("GiriÅŸ baÅŸarÄ±lÄ±!");
          // buradan sonra yÃ¶nlendirme yapabilirsin: window.location.href = "/dashboard.html";
        } catch (err) {
          alert("GiriÅŸ hatasÄ±: " + err.message);
        }
      };

      // Sayfa yÃ¼klendiÄŸinde login form aktif
      loginForm.classList.add("active");
    });
  </script>
</head>
<body>
  <!-- ğŸ” GiriÅŸ Formu -->
  <form id="loginForm">
    <h2>GiriÅŸ Yap</h2>
    <input type="email" id="loginEmail" placeholder="E-posta" required>
    <input type="password" id="loginPassword" placeholder="Åifre" required>
    <button type="submit">GiriÅŸ Yap</button>
    <p>HesabÄ±nÄ±z yok mu? <a href="#" id="switchToRegister">KayÄ±t Ol</a></p>
  </form>

  <!-- ğŸ“ KayÄ±t Formu -->
  <form id="registerForm">
    <h2>KayÄ±t Ol</h2>
    <input type="text" id="regUsername" placeholder="KullanÄ±cÄ± AdÄ±" required>
    <input type="email" id="regEmail" placeholder="E-posta" required>
    <input type="password" id="regPassword" placeholder="Åifre" required>
    <button type="submit">KayÄ±t Ol</button>
    <p>Zaten hesabÄ±nÄ±z var mÄ±? <a href="#" id="switchToLogin">GiriÅŸ Yap</a></p>
  </form>
</body>
</html>
